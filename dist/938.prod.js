(()=>{"use strict";var e,t,r={938:(e,t,r)=>{var n=r(842);const o=e=>{const{v1:t,v2:r}=e;let n=0;for(let e=0;e<t.length;e++){let o=(t[e]^r[e])>>>0;n+=s(o)}return n},s=e=>{var t=e-(e>>1&1431655765);return((t=((t=((t=(t>>2&858993459)+(858993459&t))>>4)+t&252645135)>>8)+t&16711935)>>16)+t&65535},l=e=>{const{keywidth:t,keyheight:r,querywidth:n,queryheight:o,matches:s}=e,l=1.2*n,a=-l,h=1.2*o,c=-h,u=12,f=1/Math.log(10),d=Math.max(t,r),m=Math.floor(t/2),p=Math.floor(r/2),y=[];for(let e=0;e<s.length;e++){const t=s[e].querypoint.scale,r=s[e].keypoint.scale;0==r&&console.log("ERROR divide zero");const n=t/r;y.push(n*d)}y.sort(((e,t)=>e-t));const g=.25*y[Math.floor(y.length/2)-(y.length%2==0?1:0)-1],M=Math.max(5,Math.ceil((l-a)/g)),x=Math.max(5,Math.ceil((h-c)/g)),w=M*x,b=w*u,k=[],P=[],q={};for(let e=0;e<s.length;e++){const t=s[e].querypoint,r=s[e].keypoint,{x:n,y:o,scale:d,angle:y}=i({querypoint:t,keypoint:r,keycenterX:m,keycenterY:p,scaleOneOverLogK:f});if(n<a||n>=l||o<c||o>=h||y<=-Math.PI||y>Math.PI||d<-1||d>=1){k[e]=!1;continue}let g=M*(n-a)/(l-a),T=x*(o-c)/(h-c),v=u*(y+Math.PI)/(2*Math.PI),E=10*(d- -1)/2;P[e]={binX:g,binY:T,binAngle:v,binScale:E};let C=Math.floor(g-.5),I=Math.floor(T-.5),S=Math.floor(E-.5),A=(Math.floor(v-.5)+u)%u;if(C<0||C+1>=M||I<0||I+1>=x||S<0||S+1>=10)k[e]=!1;else{for(let e=0;e<2;e++){let t=C+e;for(let e=0;e<2;e++){let r=I+e;for(let e=0;e<2;e++){let n=(A+e)%u;for(let e=0;e<2;e++){const o=t+r*M+n*w+(S+e)*b;void 0===q[o]&&(q[o]=0),q[o]+=1}}}}k[e]=!0}}let T=0,v=-1;if(Object.keys(q).forEach((e=>{q[e]>T&&(T=q[e],v=e)})),T<3)return[];const E=Math.floor(v%b%w%M),C=Math.floor((v-E)%b%w/M),I=Math.floor((v-E-C*M)%b/w),S=Math.floor((v-E-C*M-I*w)/b),A=[];for(let e=0;e<s.length;e++){if(!k[e])continue;const t=P[e];if(Math.abs(t.binX-(E+.5))>=1)continue;if(Math.abs(t.binY-(C+.5))>=1)continue;if(Math.abs(t.binScale-(S+.5))>=1)continue;const r=Math.abs(t.binAngle-(I+.5));Math.min(r,u-r)>=1||A.push(s[e])}return A},i=({querypoint:e,keypoint:t,keycenterX:r,keycenterY:n,scaleOneOverLogK:o})=>{let s=e.angle-t.angle;s<=-Math.PI?s+=2*Math.PI:s>Math.PI&&(s-=2*Math.PI);const l=e.scale/t.scale,i=l*Math.cos(s),a=l*Math.sin(s),h=[i,-a,a,i],c=[h[0]*t.x+h[1]*t.y,h[2]*t.x+h[3]*t.y],u=e.x-c[0],f=e.y-c[1];return{x:h[0]*r+h[1]*n+u,y:h[2]*r+h[3]*n+f,angle:s,scale:Math.log(l)*o}},a=()=>({seed:1234,arrayShuffle(e){const{arr:t,sampleSize:r}=e;for(let e=0;e<r;e++){this.seed=(214013*this.seed+2531011)%(1<<31);let r=this.seed>>16&32767;r%=t.length;let n=t[e];t[e]=t[r],t[r]=n}},nextInt(e){this.seed=(214013*this.seed+2531011)%(1<<31);let t=this.seed>>16&32767;return t%=e,t}}),h=(e,t,r)=>(t[0]-e[0])*(r[1]-e[1])-(t[1]-e[1])*(r[0]-e[0]),c=(e,t)=>{const r=(e=>{const t=e[4]*e[8]-e[5]*e[7],r=e[3]*e[8]-e[5]*e[6],n=e[3]*e[7]-e[4]*e[6];return e[0]*t-e[1]*r+e[2]*n})(e);if(Math.abs(r)<=t)return null;const n=1/r;return[(e[4]*e[8]-e[5]*e[7])*n,(e[2]*e[7]-e[1]*e[8])*n,(e[1]*e[5]-e[2]*e[4])*n,(e[5]*e[6]-e[3]*e[8])*n,(e[0]*e[8]-e[2]*e[6])*n,(e[2]*e[3]-e[0]*e[5])*n,(e[3]*e[7]-e[4]*e[6])*n,(e[1]*e[6]-e[0]*e[7])*n,(e[0]*e[4]-e[1]*e[3])*n]},u=(e,t)=>{const r=t[6]*e[0]+t[7]*e[1]+t[8],n=[];return n[0]=(t[0]*e[0]+t[1]*e[1]+t[2])/r,n[1]=(t[3]*e[0]+t[4]*e[1]+t[5])/r,n},f=(e,t)=>[e[0]-t[0],e[1]-t[1]],d=(e,t)=>{const r=e[0]*t[1]-e[1]*t[0];return.5*Math.abs(r)};var m=r(234),p=r(681);const y=(e,t)=>{const{normPoints:r,param:n}=g(e),{normPoints:o,param:s}=g(t),l=o.length,i=[],a=[];for(let e=0;e<l;e++){const t=[r[e][0],r[e][1],1,0,0,0,-r[e][0]*o[e][0],-r[e][1]*o[e][0]],n=[0,0,0,r[e][0],r[e][1],1,-r[e][0]*o[e][1],-r[e][1]*o[e][1]];i.push(t),i.push(n),a.push([o[e][0]]),a.push([o[e][1]])}try{const e=new m.Z(i),t=new m.Z(a),r=e.transpose(),o=r.mmul(e),l=r.mmul(t),h=(0,p.S)(o).mmul(l).to1DArray();return M(h,n,s)}catch(e){return null}},g=e=>{let t=0,r=0;for(let n=0;n<e.length;n++)t+=e[n][0],r+=e[n][1];let n=t/e.length,o=r/e.length,s=0;for(let t=0;t<e.length;t++){const r=e[t][0]-n,l=e[t][1]-o;s+=Math.sqrt(r*r+l*l)}let l=Math.sqrt(2)*e.length/s;const i=[];for(let t=0;t<e.length;t++)i.push([(e[t][0]-n)*l,(e[t][1]-o)*l]);return{normPoints:i,param:{meanX:n,meanY:o,s:l}}},M=(e,t,r)=>{const n=r.s*r.meanX,o=r.s*r.meanY,s=[e[0]+n*e[6],e[1]+n*e[7],(e[0]+n*e[6])*-t.meanX+(e[1]+n*e[7])*-t.meanY+(e[2]+n)/t.s,e[3]+o*e[6],e[4]+o*e[7],(e[3]+o*e[6])*-t.meanX+(e[4]+o*e[7])*-t.meanY+(e[5]+o)/t.s,r.s*e[6],r.s*e[7],r.s*e[6]*-t.meanX+r.s*e[7]*-t.meanY+r.s/t.s];for(let e=0;e<9;e++)s[e]=s[e]/s[8];return s},x=e=>{const{srcPoints:t,dstPoints:r,keyframe:n,quickMode:o}=e,s=[[0,0],[n.width,0],[n.width,n.height],[0,n.height]];if(t.length<4)return null;const l=Math.min(10,t.length),i=a(),c=[];for(let e=0;e<t.length;e++)c[e]=e;i.arrayShuffle({arr:c,sampleSize:c.length});const u=o?10:20,f=2*u;let d=0;const m=[];for(;d<f&&m.length<u;){if(d+=1,i.arrayShuffle({arr:c,sampleSize:4}),p=t[c[0]],g=t[c[1]],M=t[c[2]],x=t[c[3]],q=r[c[0]],T=r[c[1]],v=r[c[2]],E=r[c[3]],h(p,g,M)>0!=h(q,T,v)>0||h(g,M,x)>0!=h(T,v,E)>0||h(M,x,p)>0!=h(v,E,q)>0||h(x,p,g)>0!=h(E,q,T)>0)continue;const e=y([t[c[0]],t[c[1]],t[c[2]],t[c[3]]],[r[c[0]],r[c[1]],r[c[2]],r[c[3]]]);null!==e&&P({H:e,testPoints:s})&&m.push(e)}var p,g,M,x,q,T,v,E;if(0===m.length)return null;const C=[];for(let e=0;e<m.length;e++)C.push({H:m[e],cost:0});let I=l;for(let e=0;e<t.length&&C.length>2;e+=I){I=Math.min(l,t.length-e);let n=e+I;for(let o=0;o<C.length;o++)for(let s=e;s<n;s++){const e=k({H:C[o].H,srcPoint:t[s],dstPoint:r[s],oneOverScale2:1e4});C[o].cost+=e}C.sort(((e,t)=>e.cost-t.cost)),C.splice(-Math.floor((C.length+1)/2))}let S=null;for(let e=0;e<C.length;e++){const t=b({inH:C[e].H});if(w({H:t,testPoints:s,keyframe:n})){S=t;break}}return S},w=({H:e,testPoints:t,keyframe:r})=>{const n=c(e,1e-5);if(null===n)return!1;const o=[];for(let e=0;e<t.length;e++)o.push(u(t[e],n));return!(((e,t,r,n)=>{const o=f(t,e),s=f(r,e),l=f(n,e),i=f(t,r),a=f(n,r),h=d(o,s),c=d(s,l),u=d(o,l),m=d(i,a);return Math.min(Math.min(Math.min(h,c),u),m)})(o[0],o[1],o[2],o[3])<r.width*r.height*1e-4||!((e,t,r,n)=>{const o=h(e,t,r)<=0;return h(t,r,n)<=0===o&&h(r,n,e)<=0===o&&h(n,e,t)<=0===o})(o[0],o[1],o[2],o[3]))},b=({inH:e})=>{const t=1/e[8],r=[];for(let n=0;n<8;n++)r[n]=e[n]*t;return r[8]=1,r},k=({H:e,srcPoint:t,dstPoint:r,oneOverScale2:n})=>{const o=u(t,e),s=[o[0]-r[0],o[1]-r[1]];return Math.log(1+(s[0]*s[0]+s[1]*s[1])*n)},P=({H:e,testPoints:t})=>{const r=[];for(let n=0;n<t.length;n++)r[n]=u(t[n],e);for(let e=0;e<t.length;e++){const c=e,u=(e+1)%t.length,f=(e+2)%t.length;if(n=t[c],o=t[u],s=t[f],l=r[c],i=r[u],a=r[f],h(n,o,s)>0!=h(l,i,a)>0)return!1}var n,o,s,l,i,a;return!0},q=({keyframe:e,querypoints:t,querywidth:r,queryheight:s,debugMode:i})=>{let a={};const h=[];for(let r=0;r<t.length;r++){const s=t[r],l=s.maxima?e.maximaPoints:e.minimaPoints;if(0===l.length)continue;const i=s.maxima?e.maximaPointsCluster.rootNode:e.minimaPointsCluster.rootNode,a=[],c=new n.Z([],((e,t)=>e.d-t.d));T({node:i,keypoints:l,querypoint:s,queue:c,keypointIndexes:a,numPop:0});let u=-1,f=Number.MAX_SAFE_INTEGER,d=Number.MAX_SAFE_INTEGER;for(let e=0;e<a.length;e++){const t=l[a[e]],r=o({v1:t.descriptors,v2:s.descriptors});r<f?(d=f,f=r,u=a[e]):r<d&&(d=r)}-1!==u&&(d===Number.MAX_SAFE_INTEGER||1*f/d<.7)&&h.push({querypoint:s,keypoint:l[u]})}if(i&&(a.matches=h),h.length<6)return{debugExtra:a};const f=l({keywidth:e.width,keyheight:e.height,querywidth:r,queryheight:s,matches:h});i&&(a.houghMatches=f);const d=x({srcPoints:f.map((e=>[e.keypoint.x,e.keypoint.y])),dstPoints:f.map((e=>[e.querypoint.x,e.querypoint.y])),keyframe:e});if(null===d)return{debugExtra:a};const m=v({H:d,matches:f,threshold:3});if(i&&(a.inlierMatches=m),m.length<6)return{debugExtra:a};const p=c(d,1e-5),y=[];for(let r=0;r<t.length;r++){const n=t[r],s=u([n.x,n.y],p);let l=-1,i=Number.MAX_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER;const h=n.maxima?e.maximaPoints:e.minimaPoints;for(let e=0;e<h.length;e++){const t=h[e];if((t.x-s[0])*(t.x-s[0])+(t.y-s[1])*(t.y-s[1])>100)continue;const r=o({v1:t.descriptors,v2:n.descriptors});r<i?(a=i,i=r,l=e):r<a&&(a=r)}-1!==l&&(a===Number.MAX_SAFE_INTEGER||1*i/a<.7)&&y.push({querypoint:n,keypoint:h[l]})}i&&(a.matches2=y);const g=l({keywidth:e.width,keyheight:e.height,querywidth:r,queryheight:s,matches:y});i&&(a.houghMatches2=g);const M=x({srcPoints:g.map((e=>[e.keypoint.x,e.keypoint.y])),dstPoints:g.map((e=>[e.querypoint.x,e.querypoint.y])),keyframe:e});if(null===M)return{debugExtra:a};const w=v({H:M,matches:g,threshold:3});return i&&(a.inlierMatches2=w),{H:M,matches:w,debugExtra:a}},T=({node:e,keypoints:t,querypoint:r,queue:n,keypointIndexes:s,numPop:l})=>{if(e.leaf){for(let t=0;t<e.pointIndexes.length;t++)s.push(e.pointIndexes[t]);return}const i=[];for(let n=0;n<e.children.length;n++){const s=e.children[n].centerPointIndex,l=o({v1:t[s].descriptors,v2:r.descriptors});i.push(l)}let a=Number.MAX_SAFE_INTEGER;for(let t=0;t<e.children.length;t++)a=Math.min(a,i[t]);for(let t=0;t<e.children.length;t++)i[t]!==a&&n.push({node:e.children[t],d:i[t]});for(let o=0;o<e.children.length;o++)i[o]===a&&T({node:e.children[o],keypoints:t,querypoint:r,queue:n,keypointIndexes:s,numPop:l});if(l<8&&n.length>0){const{node:e,d:o}=n.pop();T({node:e,keypoints:t,querypoint:r,queue:n,keypointIndexes:s,numPop:l+=1})}},v=e=>{const{H:t,matches:r,threshold:n}=e,o=n*n,s=[];for(let e=0;e<r.length;e++){const n=r[e].querypoint,l=r[e].keypoint,i=u([l.x,l.y],t);(i[0]-n.x)*(i[0]-n.x)+(i[1]-n.y)*(i[1]-n.y)<=o&&s.push(r[e])}return s};class E{constructor(e,t,r=!1){this.queryWidth=e,this.queryHeight=t,this.debugMode=r}matchDetection(e,t){let r={frames:[]},n=null;for(let o=0;o<e.length;o++){const{H:s,matches:l,debugExtra:i}=q({keyframe:e[o],querypoints:t,querywidth:this.queryWidth,queryheight:this.queryHeight,debugMode:this.debugMode});r.frames.push(i),s&&(null===n||n.matches.length<l.length)&&(n={keyframeIndex:o,H:s,matches:l})}if(null===n)return{keyframeIndex:-1,debugExtra:r};const o=[],s=[],l=e[n.keyframeIndex];for(let e=0;e<n.matches.length;e++){const t=n.matches[e].querypoint,r=n.matches[e].keypoint;o.push({x:t.x,y:t.y}),s.push({x:(r.x+.5)/l.scale,y:(r.y+.5)/l.scale,z:0})}return{screenCoords:o,worldCoords:s,keyframeIndex:n.keyframeIndex,debugExtra:r}}}const C=(e,t)=>[[e[0][0]*t[0][0]+e[0][2]*t[2][0],e[0][0]*t[0][1]+e[0][2]*t[2][1],e[0][0]*t[0][2]+e[0][2]*t[2][2],e[0][0]*t[0][3]+e[0][2]*t[2][3]],[e[1][1]*t[1][0]+e[1][2]*t[2][0],e[1][1]*t[1][1]+e[1][2]*t[2][1],e[1][1]*t[1][2]+e[1][2]*t[2][2],e[1][1]*t[1][3]+e[1][2]*t[2][3]],[t[2][0],t[2][1],t[2][2],t[2][3]]],I=(e,t,r,n)=>({x:e[0][0]*t+e[0][1]*r+e[0][3],y:e[1][0]*t+e[1][1]*r+e[1][3],z:e[2][0]*t+e[2][1]*r+e[2][3]}),S=(e,t,r,n)=>{const{x:o,y:s,z:l}=I(e,t,r);return{x:o/l,y:s/l}};let A=[[],[],[]],j=[[],[]],H=[[],[],[]];const _=({initialModelViewTransform:e,projectionTransform:t,worldCoords:r,screenCoords:n,inlierProb:o})=>{const s=o<1;let l=e,i=0,a=0,h=new Array(r.length),c=new Array(r.length),u=new Array(r.length),f=new Array(r.length);for(let e=0;e<=10;e++){const d=C(t,l);for(let e=0;e<r.length;e++){const t=S(d,r[e].x,r[e].y,r[e].z),o=n[e].x-t.x,s=n[e].y-t.y;u[e]=o,f[e]=s,h[e]=o*o+s*s}let m;if(a=0,s){const e=Math.max(3,Math.floor(r.length*o)-1);for(let e=0;e<r.length;e++)c[e]=h[e];c.sort(((e,t)=>e-t)),m=Math.max(4*c[e],16);for(let e=0;e<r.length;e++)c[e]>m?a+=m/6:a+=m/6*(1-(1-c[e]/m)*(1-c[e]/m)*(1-c[e]/m))}else for(let e=0;e<r.length;e++)a+=h[e];if(a/=r.length,a<.1)break;if(e>0&&a/i>.99)break;if(10===e)break;i=a;const p=[],y=[];for(let e=0;e<r.length;e++){if(s&&h[e]>m)continue;const n=N({modelViewProjectionTransform:d,modelViewTransform:l,projectionTransform:t,worldCoord:r[e]});if(s){const t=(1-h[e]/m)*(1-h[e]/m);for(let e=0;e<2;e++)for(let r=0;r<6;r++)n[e][r]*=t;p.push([u[e]*t]),p.push([f[e]*t])}else p.push([u[e]]),p.push([f[e]]);for(let e=0;e<n.length;e++)y.push(n[e])}const g=O({dU:p,J_U_S:y});if(null===g)break;l=z({modelViewTransform:l,dS:g})}return{modelViewTransform:l,err:a}},z=({modelViewTransform:e,dS:t})=>{let r,n,o,s=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];s<1e-6?(r=1,n=0,o=0,s=0):(s=Math.sqrt(s),r=t[0]/s,n=t[1]/s,o=t[2]/s);const l=Math.cos(s),i=Math.sin(s),a=1-l;A[0][0]=r*r*a+l,A[0][1]=r*n*a-o*i,A[0][2]=r*o*a+n*i,A[0][3]=t[3],A[1][0]=n*r*a+o*i,A[1][1]=n*n*a+l,A[1][2]=n*o*a-r*i,A[1][3]=t[4],A[2][0]=o*r*a-n*i,A[2][1]=o*n*a+r*i,A[2][2]=o*o*a+l,A[2][3]=t[5];const h=[[],[],[]];for(let t=0;t<3;t++){for(let r=0;r<4;r++)h[t][r]=e[t][0]*A[0][r]+e[t][1]*A[1][r]+e[t][2]*A[2][r];h[t][3]+=e[t][3]}return h},O=({dU:e,J_U_S:t})=>{const r=new m.Z(t),n=new m.Z(e),o=r.transpose(),s=o.mmul(r),l=o.mmul(n);let i;try{i=(0,p.S)(s)}catch(e){return null}return i.mmul(l).to1DArray()},N=({modelViewProjectionTransform:e,modelViewTransform:t,projectionTransform:r,worldCoord:n})=>{const o=t,{x:s,y:l,z:i}=n,a=I(e,s,l),h=a.z*a.z;j[0][0]=r[0][0]*a.z/h,j[0][1]=r[0][1]*a.z/h,j[0][2]=(r[0][2]*a.z-r[2][2]*a.x)/h,j[1][0]=r[1][0]*a.z/h,j[1][1]=r[1][1]*a.z/h,j[1][2]=(r[1][2]*a.z-r[2][2]*a.y)/h,H[0][0]=o[0][2]*l,H[0][1]=-o[0][2]*s,H[0][2]=o[0][1]*s-o[0][0]*l,H[0][3]=o[0][0],H[0][4]=o[0][1],H[0][5]=o[0][2],H[1][0]=o[1][2]*l,H[1][1]=-o[1][2]*s,H[1][2]=o[1][1]*s-o[1][0]*l,H[1][3]=o[1][0],H[1][4]=o[1][1],H[1][5]=o[1][2],H[2][0]=o[2][2]*l,H[2][1]=-o[2][2]*s,H[2][2]=o[2][1]*s-o[2][0]*l,H[2][3]=o[2][0],H[2][4]=o[2][1],H[2][5]=o[2][2];const c=[[],[]];for(let e=0;e<2;e++)for(let t=0;t<6;t++){c[e][t]=0;for(let r=0;r<3;r++)c[e][t]+=j[e][r]*H[r][t]}return c};class V{constructor(e){this.projectionTransform=e}estimate({screenCoords:e,worldCoords:t}){const r=(({screenCoords:e,worldCoords:t,projectionTransform:r})=>{const n=y(t.map((e=>[e.x,e.y])),e.map((e=>[e.x,e.y]))),o=new m.Z([[n[0],n[1],n[2]],[n[3],n[4],n[5]],[n[6],n[7],n[8]]]),s=new m.Z(r),l=(0,p.S)(s).mmul(o).to1DArray(),i=Math.sqrt(l[0]*l[0]+l[3]*l[3]+l[6]*l[6]),a=Math.sqrt(l[1]*l[1]+l[4]*l[4]+l[7]*l[7]),h=(i+a)/2,c=[];c[0]=l[0]/i,c[3]=l[3]/i,c[6]=l[6]/i,c[1]=l[1]/a,c[4]=l[4]/a,c[7]=l[7]/a,c[2]=c[3]*c[7]-c[6]*c[4],c[5]=c[6]*c[1]-c[0]*c[7],c[8]=c[0]*c[4]-c[1]*c[3];const u=Math.sqrt(c[2]*c[2]+c[5]*c[5]+c[8]*c[8]);c[2]/=u,c[5]/=u,c[8]/=u;const f=[];return f[0]=l[2]/h,f[1]=l[5]/h,f[2]=l[8]/h,[[c[0],c[1],c[2],f[0]],[c[3],c[4],c[5],f[1]],[c[6],c[7],c[8],f[2]]]})({screenCoords:e,worldCoords:t,projectionTransform:this.projectionTransform});return r}refineEstimate({initialModelViewTransform:e,worldCoords:t,screenCoords:r}){const n=(({initialModelViewTransform:e,projectionTransform:t,worldCoords:r,screenCoords:n})=>{let o=0,s=0;for(let e=0;e<r.length;e++)o+=r[e].x,s+=r[e].y;o/=r.length,s/=r.length;const l=[];for(let e=0;e<r.length;e++)l.push({x:r[e].x-o,y:r[e].y-s,z:r[e].z});const i=[[],[],[]];for(let t=0;t<3;t++)for(let r=0;r<3;r++)i[t][r]=e[t][r];i[0][3]=e[0][0]*o+e[0][1]*s+e[0][3],i[1][3]=e[1][0]*o+e[1][1]*s+e[1][3],i[2][3]=e[2][0]*o+e[2][1]*s+e[2][3];const a=[1,.8,.6,.4,0];let h=i,c=null;for(let e=0;e<a.length;e++){const r=_({initialModelViewTransform:h,projectionTransform:t,worldCoords:l,screenCoords:n,inlierProb:a[e]});if(h=r.modelViewTransform,r.err<5){c=h;break}}return null===c?null:(c[0][3]=c[0][3]-c[0][0]*o-c[0][1]*s,c[1][3]=c[1][3]-c[1][0]*o-c[1][1]*s,c[2][3]=c[2][3]-c[2][0]*o-c[2][1]*s,c)})({initialModelViewTransform:e,worldCoords:t,screenCoords:r,projectionTransform:this.projectionTransform});return n}}let X=null,R=null,Y=!1,D=null,F=null;onmessage=e=>{const{data:t}=e;if("setup"===t.type)X=t.projectionTransform,R=t.matchingDataList,Y=t.debugMode,D=new E(t.inputWidth,t.inputHeight,Y),F=new V(t.projectionTransform);else if("match"===t.type){const e=t.targetIndexes;let r=-1,n=null,o=null;for(let s=0;s<e.length;s++){const l=e[s],{keyframeIndex:i,screenCoords:a,worldCoords:h,debugExtra:c}=D.matchDetection(R[l],t.featurePoints);if(o=c,-1!==i){const e=F.estimate({screenCoords:a,worldCoords:h});e&&(r=l,n=e);break}}postMessage({type:"matchDone",targetIndex:r,modelViewTransform:n,debugExtra:o})}else if("trackUpdate"===t.type){const{modelViewTransform:e,worldCoords:r,screenCoords:n}=t,o=F.refineEstimate({initialModelViewTransform:e,worldCoords:r,screenCoords:n});postMessage({type:"trackUpdateDone",modelViewTransform:o})}}}},n={};function o(e){var t=n[e];if(void 0!==t)return t.exports;var s=n[e]={exports:{}};return r[e](s,s.exports,o),s.exports}o.m=r,o.x=()=>{var e=o.O(void 0,[551],(()=>o(938)));return o.O(e)},e=[],o.O=(t,r,n,s)=>{if(!r){var l=1/0;for(c=0;c<e.length;c++){for(var[r,n,s]=e[c],i=!0,a=0;a<r.length;a++)(!1&s||l>=s)&&Object.keys(o.O).every((e=>o.O[e](r[a])))?r.splice(a--,1):(i=!1,s<l&&(l=s));if(i){e.splice(c--,1);var h=n();void 0!==h&&(t=h)}}return t}s=s||0;for(var c=e.length;c>0&&e[c-1][2]>s;c--)e[c]=e[c-1];e[c]=[r,n,s]},o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce(((t,r)=>(o.f[r](e,t),t)),[])),o.u=e=>e+".prod.js",o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;o.g.importScripts&&(e=o.g.location+"");var t=o.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");r.length&&(e=r[r.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=e})(),(()=>{var e={938:1};o.f.i=(t,r)=>{e[t]||importScripts(o.p+o.u(t))};var t=self.webpackChunkmind_ar=self.webpackChunkmind_ar||[],r=t.push.bind(t);t.push=t=>{var[n,s,l]=t;for(var i in s)o.o(s,i)&&(o.m[i]=s[i]);for(l&&l(o);n.length;)e[n.pop()]=1;r(t)}})(),t=o.x,o.x=()=>o.e(551).then(t),o.x()})();