var e,t={938:(e,t,n)=>{var r=n(842);const o=e=>{const{v1:t,v2:n}=e;let r=0;for(let e=0;e<t.length;e++){let o=(t[e]^n[e])>>>0;r+=s(o)}return r},s=e=>{var t=e-(e>>1&1431655765);return((t=((t=((t=(t>>2&858993459)+(858993459&t))>>4)+t&252645135)>>8)+t&16711935)>>16)+t&65535},l=e=>{const{keywidth:t,keyheight:n,querywidth:r,queryheight:o,matches:s}=e,l=1.2*r,a=-l,h=1.2*o,c=-h,u=12,f=1/Math.log(10),d=Math.max(t,n),m=Math.floor(t/2),y=Math.floor(n/2),p=[];for(let e=0;e<s.length;e++){const t=s[e].querypoint.scale,n=s[e].keypoint.scale;0==n&&console.log("ERROR divide zero");const r=t/n;p.push(r*d)}p.sort(((e,t)=>e-t));const g=.25*p[Math.floor(p.length/2)-(p.length%2==0?1:0)-1],M=Math.max(5,Math.ceil((l-a)/g)),x=Math.max(5,Math.ceil((h-c)/g)),w=M*x,k=w*u,b=[],q=[],P={};for(let e=0;e<s.length;e++){const t=s[e].querypoint,n=s[e].keypoint,{x:r,y:o,scale:d,angle:p}=i({querypoint:t,keypoint:n,keycenterX:m,keycenterY:y,scaleOneOverLogK:f});if(r<a||r>=l||o<c||o>=h||p<=-Math.PI||p>Math.PI||d<-1||d>=1){b[e]=!1;continue}let g=M*(r-a)/(l-a),T=x*(o-c)/(h-c),E=u*(p+Math.PI)/(2*Math.PI),v=10*(d- -1)/2;q[e]={binX:g,binY:T,binAngle:E,binScale:v};let I=Math.floor(g-.5),C=Math.floor(T-.5),S=Math.floor(v-.5),A=(Math.floor(E-.5)+u)%u;if(I<0||I+1>=M||C<0||C+1>=x||S<0||S+1>=10)b[e]=!1;else{for(let e=0;e<2;e++){let t=I+e;for(let e=0;e<2;e++){let n=C+e;for(let e=0;e<2;e++){let r=(A+e)%u;for(let e=0;e<2;e++){const o=t+n*M+r*w+(S+e)*k;void 0===P[o]&&(P[o]=0),P[o]+=1}}}}b[e]=!0}}let T=0,E=-1;if(Object.keys(P).forEach((e=>{P[e]>T&&(T=P[e],E=e)})),T<3)return[];const v=Math.floor(E%k%w%M),I=Math.floor((E-v)%k%w/M),C=Math.floor((E-v-I*M)%k/w),S=Math.floor((E-v-I*M-C*w)/k),A=[];for(let e=0;e<s.length;e++){if(!b[e])continue;const t=q[e];if(Math.abs(t.binX-(v+.5))>=1)continue;if(Math.abs(t.binY-(I+.5))>=1)continue;if(Math.abs(t.binScale-(S+.5))>=1)continue;const n=Math.abs(t.binAngle-(C+.5));Math.min(n,u-n)>=1||A.push(s[e])}return A},i=({querypoint:e,keypoint:t,keycenterX:n,keycenterY:r,scaleOneOverLogK:o})=>{let s=e.angle-t.angle;s<=-Math.PI?s+=2*Math.PI:s>Math.PI&&(s-=2*Math.PI);const l=e.scale/t.scale,i=l*Math.cos(s),a=l*Math.sin(s),h=[i,-a,a,i],c=[h[0]*t.x+h[1]*t.y,h[2]*t.x+h[3]*t.y],u=e.x-c[0],f=e.y-c[1];return{x:h[0]*n+h[1]*r+u,y:h[2]*n+h[3]*r+f,angle:s,scale:Math.log(l)*o}},a=()=>({seed:1234,arrayShuffle(e){const{arr:t,sampleSize:n}=e;for(let e=0;e<n;e++){this.seed=(214013*this.seed+2531011)%(1<<31);let n=this.seed>>16&32767;n%=t.length;let r=t[e];t[e]=t[n],t[n]=r}},nextInt(e){this.seed=(214013*this.seed+2531011)%(1<<31);let t=this.seed>>16&32767;return t%=e,t}}),h=(e,t,n)=>(t[0]-e[0])*(n[1]-e[1])-(t[1]-e[1])*(n[0]-e[0]),c=(e,t)=>{const n=(e=>{const t=e[4]*e[8]-e[5]*e[7],n=e[3]*e[8]-e[5]*e[6],r=e[3]*e[7]-e[4]*e[6];return e[0]*t-e[1]*n+e[2]*r})(e);if(Math.abs(n)<=t)return null;const r=1/n;return[(e[4]*e[8]-e[5]*e[7])*r,(e[2]*e[7]-e[1]*e[8])*r,(e[1]*e[5]-e[2]*e[4])*r,(e[5]*e[6]-e[3]*e[8])*r,(e[0]*e[8]-e[2]*e[6])*r,(e[2]*e[3]-e[0]*e[5])*r,(e[3]*e[7]-e[4]*e[6])*r,(e[1]*e[6]-e[0]*e[7])*r,(e[0]*e[4]-e[1]*e[3])*r]},u=(e,t)=>{const n=t[6]*e[0]+t[7]*e[1]+t[8],r=[];return r[0]=(t[0]*e[0]+t[1]*e[1]+t[2])/n,r[1]=(t[3]*e[0]+t[4]*e[1]+t[5])/n,r},f=(e,t)=>[e[0]-t[0],e[1]-t[1]],d=(e,t)=>{const n=e[0]*t[1]-e[1]*t[0];return.5*Math.abs(n)};var m=n(234),y=n(681);const p=(e,t)=>{const{normPoints:n,param:r}=g(e),{normPoints:o,param:s}=g(t),l=o.length,i=[],a=[];for(let e=0;e<l;e++){const t=[n[e][0],n[e][1],1,0,0,0,-n[e][0]*o[e][0],-n[e][1]*o[e][0]],r=[0,0,0,n[e][0],n[e][1],1,-n[e][0]*o[e][1],-n[e][1]*o[e][1]];i.push(t),i.push(r),a.push([o[e][0]]),a.push([o[e][1]])}try{const e=new m.Z(i),t=new m.Z(a),n=e.transpose(),o=n.mmul(e),l=n.mmul(t),h=(0,y.S)(o).mmul(l).to1DArray();return M(h,r,s)}catch(e){return null}},g=e=>{let t=0,n=0;for(let r=0;r<e.length;r++)t+=e[r][0],n+=e[r][1];let r=t/e.length,o=n/e.length,s=0;for(let t=0;t<e.length;t++){const n=e[t][0]-r,l=e[t][1]-o;s+=Math.sqrt(n*n+l*l)}let l=Math.sqrt(2)*e.length/s;const i=[];for(let t=0;t<e.length;t++)i.push([(e[t][0]-r)*l,(e[t][1]-o)*l]);return{normPoints:i,param:{meanX:r,meanY:o,s:l}}},M=(e,t,n)=>{const r=n.s*n.meanX,o=n.s*n.meanY,s=[e[0]+r*e[6],e[1]+r*e[7],(e[0]+r*e[6])*-t.meanX+(e[1]+r*e[7])*-t.meanY+(e[2]+r)/t.s,e[3]+o*e[6],e[4]+o*e[7],(e[3]+o*e[6])*-t.meanX+(e[4]+o*e[7])*-t.meanY+(e[5]+o)/t.s,n.s*e[6],n.s*e[7],n.s*e[6]*-t.meanX+n.s*e[7]*-t.meanY+n.s/t.s];for(let e=0;e<9;e++)s[e]=s[e]/s[8];return s},x=e=>{const{srcPoints:t,dstPoints:n,keyframe:r,quickMode:o}=e,s=[[0,0],[r.width,0],[r.width,r.height],[0,r.height]];if(t.length<4)return null;const l=Math.min(10,t.length),i=a(),c=[];for(let e=0;e<t.length;e++)c[e]=e;i.arrayShuffle({arr:c,sampleSize:c.length});const u=o?10:20,f=2*u;let d=0;const m=[];for(;d<f&&m.length<u;){if(d+=1,i.arrayShuffle({arr:c,sampleSize:4}),y=t[c[0]],g=t[c[1]],M=t[c[2]],x=t[c[3]],P=n[c[0]],T=n[c[1]],E=n[c[2]],v=n[c[3]],h(y,g,M)>0!=h(P,T,E)>0||h(g,M,x)>0!=h(T,E,v)>0||h(M,x,y)>0!=h(E,v,P)>0||h(x,y,g)>0!=h(v,P,T)>0)continue;const e=p([t[c[0]],t[c[1]],t[c[2]],t[c[3]]],[n[c[0]],n[c[1]],n[c[2]],n[c[3]]]);null!==e&&q({H:e,testPoints:s})&&m.push(e)}var y,g,M,x,P,T,E,v;if(0===m.length)return null;const I=[];for(let e=0;e<m.length;e++)I.push({H:m[e],cost:0});let C=l;for(let e=0;e<t.length&&I.length>2;e+=C){C=Math.min(l,t.length-e);let r=e+C;for(let o=0;o<I.length;o++)for(let s=e;s<r;s++){const e=b({H:I[o].H,srcPoint:t[s],dstPoint:n[s],oneOverScale2:1e4});I[o].cost+=e}I.sort(((e,t)=>e.cost-t.cost)),I.splice(-Math.floor((I.length+1)/2))}let S=null;for(let e=0;e<I.length;e++){const t=k({inH:I[e].H});if(w({H:t,testPoints:s,keyframe:r})){S=t;break}}return S},w=({H:e,testPoints:t,keyframe:n})=>{const r=c(e,1e-5);if(null===r)return!1;const o=[];for(let e=0;e<t.length;e++)o.push(u(t[e],r));return!(((e,t,n,r)=>{const o=f(t,e),s=f(n,e),l=f(r,e),i=f(t,n),a=f(r,n),h=d(o,s),c=d(s,l),u=d(o,l),m=d(i,a);return Math.min(Math.min(Math.min(h,c),u),m)})(o[0],o[1],o[2],o[3])<n.width*n.height*1e-4||!((e,t,n,r)=>{const o=h(e,t,n)<=0;return h(t,n,r)<=0===o&&h(n,r,e)<=0===o&&h(r,e,t)<=0===o})(o[0],o[1],o[2],o[3]))},k=({inH:e})=>{const t=1/e[8],n=[];for(let r=0;r<8;r++)n[r]=e[r]*t;return n[8]=1,n},b=({H:e,srcPoint:t,dstPoint:n,oneOverScale2:r})=>{const o=u(t,e),s=[o[0]-n[0],o[1]-n[1]];return Math.log(1+(s[0]*s[0]+s[1]*s[1])*r)},q=({H:e,testPoints:t})=>{const n=[];for(let r=0;r<t.length;r++)n[r]=u(t[r],e);for(let e=0;e<t.length;e++){const c=e,u=(e+1)%t.length,f=(e+2)%t.length;if(r=t[c],o=t[u],s=t[f],l=n[c],i=n[u],a=n[f],h(r,o,s)>0!=h(l,i,a)>0)return!1}var r,o,s,l,i,a;return!0},P=({keyframe:e,querypoints:t,querywidth:n,queryheight:s,debugMode:i})=>{let a={};const h=[];for(let n=0;n<t.length;n++){const s=t[n],l=s.maxima?e.maximaPoints:e.minimaPoints;if(0===l.length)continue;const i=s.maxima?e.maximaPointsCluster.rootNode:e.minimaPointsCluster.rootNode,a=[],c=new r.Z([],((e,t)=>e.d-t.d));T({node:i,keypoints:l,querypoint:s,queue:c,keypointIndexes:a,numPop:0});let u=-1,f=Number.MAX_SAFE_INTEGER,d=Number.MAX_SAFE_INTEGER;for(let e=0;e<a.length;e++){const t=l[a[e]],n=o({v1:t.descriptors,v2:s.descriptors});n<f?(d=f,f=n,u=a[e]):n<d&&(d=n)}-1!==u&&(d===Number.MAX_SAFE_INTEGER||1*f/d<.7)&&h.push({querypoint:s,keypoint:l[u]})}if(i&&(a.matches=h),h.length<6)return{debugExtra:a};const f=l({keywidth:e.width,keyheight:e.height,querywidth:n,queryheight:s,matches:h});i&&(a.houghMatches=f);const d=x({srcPoints:f.map((e=>[e.keypoint.x,e.keypoint.y])),dstPoints:f.map((e=>[e.querypoint.x,e.querypoint.y])),keyframe:e});if(null===d)return{debugExtra:a};const m=E({H:d,matches:f,threshold:3});if(i&&(a.inlierMatches=m),m.length<6)return{debugExtra:a};const y=c(d,1e-5),p=[];for(let n=0;n<t.length;n++){const r=t[n],s=u([r.x,r.y],y);let l=-1,i=Number.MAX_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER;const h=r.maxima?e.maximaPoints:e.minimaPoints;for(let e=0;e<h.length;e++){const t=h[e];if((t.x-s[0])*(t.x-s[0])+(t.y-s[1])*(t.y-s[1])>100)continue;const n=o({v1:t.descriptors,v2:r.descriptors});n<i?(a=i,i=n,l=e):n<a&&(a=n)}-1!==l&&(a===Number.MAX_SAFE_INTEGER||1*i/a<.7)&&p.push({querypoint:r,keypoint:h[l]})}i&&(a.matches2=p);const g=l({keywidth:e.width,keyheight:e.height,querywidth:n,queryheight:s,matches:p});i&&(a.houghMatches2=g);const M=x({srcPoints:g.map((e=>[e.keypoint.x,e.keypoint.y])),dstPoints:g.map((e=>[e.querypoint.x,e.querypoint.y])),keyframe:e});if(null===M)return{debugExtra:a};const w=E({H:M,matches:g,threshold:3});return i&&(a.inlierMatches2=w),{H:M,matches:w,debugExtra:a}},T=({node:e,keypoints:t,querypoint:n,queue:r,keypointIndexes:s,numPop:l})=>{if(e.leaf){for(let t=0;t<e.pointIndexes.length;t++)s.push(e.pointIndexes[t]);return}const i=[];for(let r=0;r<e.children.length;r++){const s=e.children[r].centerPointIndex,l=o({v1:t[s].descriptors,v2:n.descriptors});i.push(l)}let a=Number.MAX_SAFE_INTEGER;for(let t=0;t<e.children.length;t++)a=Math.min(a,i[t]);for(let t=0;t<e.children.length;t++)i[t]!==a&&r.push({node:e.children[t],d:i[t]});for(let o=0;o<e.children.length;o++)i[o]===a&&T({node:e.children[o],keypoints:t,querypoint:n,queue:r,keypointIndexes:s,numPop:l});if(l<8&&r.length>0){const{node:e,d:o}=r.pop();T({node:e,keypoints:t,querypoint:n,queue:r,keypointIndexes:s,numPop:l+=1})}},E=e=>{const{H:t,matches:n,threshold:r}=e,o=r*r,s=[];for(let e=0;e<n.length;e++){const r=n[e].querypoint,l=n[e].keypoint,i=u([l.x,l.y],t);(i[0]-r.x)*(i[0]-r.x)+(i[1]-r.y)*(i[1]-r.y)<=o&&s.push(n[e])}return s};class v{constructor(e,t,n=!1){this.queryWidth=e,this.queryHeight=t,this.debugMode=n}matchDetection(e,t){let n={frames:[]},r=null;for(let o=0;o<e.length;o++){const{H:s,matches:l,debugExtra:i}=P({keyframe:e[o],querypoints:t,querywidth:this.queryWidth,queryheight:this.queryHeight,debugMode:this.debugMode});n.frames.push(i),s&&(null===r||r.matches.length<l.length)&&(r={keyframeIndex:o,H:s,matches:l})}if(null===r)return{keyframeIndex:-1,debugExtra:n};const o=[],s=[],l=e[r.keyframeIndex];for(let e=0;e<r.matches.length;e++){const t=r.matches[e].querypoint,n=r.matches[e].keypoint;o.push({x:t.x,y:t.y}),s.push({x:(n.x+.5)/l.scale,y:(n.y+.5)/l.scale,z:0})}return{screenCoords:o,worldCoords:s,keyframeIndex:r.keyframeIndex,debugExtra:n}}}const I=(e,t)=>[[e[0][0]*t[0][0]+e[0][2]*t[2][0],e[0][0]*t[0][1]+e[0][2]*t[2][1],e[0][0]*t[0][2]+e[0][2]*t[2][2],e[0][0]*t[0][3]+e[0][2]*t[2][3]],[e[1][1]*t[1][0]+e[1][2]*t[2][0],e[1][1]*t[1][1]+e[1][2]*t[2][1],e[1][1]*t[1][2]+e[1][2]*t[2][2],e[1][1]*t[1][3]+e[1][2]*t[2][3]],[t[2][0],t[2][1],t[2][2],t[2][3]]],C=(e,t,n,r)=>({x:e[0][0]*t+e[0][1]*n+e[0][3],y:e[1][0]*t+e[1][1]*n+e[1][3],z:e[2][0]*t+e[2][1]*n+e[2][3]}),S=(e,t,n,r)=>{const{x:o,y:s,z:l}=C(e,t,n);return{x:o/l,y:s/l}};let A=[[],[],[]],H=[[],[]],j=[[],[],[]];const z=({initialModelViewTransform:e,projectionTransform:t,worldCoords:n,screenCoords:r,inlierProb:o})=>{const s=o<1;let l=e,i=0,a=0,h=new Array(n.length),c=new Array(n.length),u=new Array(n.length),f=new Array(n.length);for(let e=0;e<=10;e++){const d=I(t,l);for(let e=0;e<n.length;e++){const t=S(d,n[e].x,n[e].y,n[e].z),o=r[e].x-t.x,s=r[e].y-t.y;u[e]=o,f[e]=s,h[e]=o*o+s*s}let m;if(a=0,s){const e=Math.max(3,Math.floor(n.length*o)-1);for(let e=0;e<n.length;e++)c[e]=h[e];c.sort(((e,t)=>e-t)),m=Math.max(4*c[e],16);for(let e=0;e<n.length;e++)c[e]>m?a+=m/6:a+=m/6*(1-(1-c[e]/m)*(1-c[e]/m)*(1-c[e]/m))}else for(let e=0;e<n.length;e++)a+=h[e];if(a/=n.length,a<.1)break;if(e>0&&a/i>.99)break;if(10===e)break;i=a;const y=[],p=[];for(let e=0;e<n.length;e++){if(s&&h[e]>m)continue;const r=V({modelViewProjectionTransform:d,modelViewTransform:l,projectionTransform:t,worldCoord:n[e]});if(s){const t=(1-h[e]/m)*(1-h[e]/m);for(let e=0;e<2;e++)for(let n=0;n<6;n++)r[e][n]*=t;y.push([u[e]*t]),y.push([f[e]*t])}else y.push([u[e]]),y.push([f[e]]);for(let e=0;e<r.length;e++)p.push(r[e])}const g=O({dU:y,J_U_S:p});if(null===g)break;l=_({modelViewTransform:l,dS:g})}return{modelViewTransform:l,err:a}},_=({modelViewTransform:e,dS:t})=>{let n,r,o,s=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];s<1e-6?(n=1,r=0,o=0,s=0):(s=Math.sqrt(s),n=t[0]/s,r=t[1]/s,o=t[2]/s);const l=Math.cos(s),i=Math.sin(s),a=1-l;A[0][0]=n*n*a+l,A[0][1]=n*r*a-o*i,A[0][2]=n*o*a+r*i,A[0][3]=t[3],A[1][0]=r*n*a+o*i,A[1][1]=r*r*a+l,A[1][2]=r*o*a-n*i,A[1][3]=t[4],A[2][0]=o*n*a-r*i,A[2][1]=o*r*a+n*i,A[2][2]=o*o*a+l,A[2][3]=t[5];const h=[[],[],[]];for(let t=0;t<3;t++){for(let n=0;n<4;n++)h[t][n]=e[t][0]*A[0][n]+e[t][1]*A[1][n]+e[t][2]*A[2][n];h[t][3]+=e[t][3]}return h},O=({dU:e,J_U_S:t})=>{const n=new m.Z(t),r=new m.Z(e),o=n.transpose(),s=o.mmul(n),l=o.mmul(r);let i;try{i=(0,y.S)(s)}catch(e){return null}return i.mmul(l).to1DArray()},V=({modelViewProjectionTransform:e,modelViewTransform:t,projectionTransform:n,worldCoord:r})=>{const o=t,{x:s,y:l,z:i}=r,a=C(e,s,l),h=a.z*a.z;H[0][0]=n[0][0]*a.z/h,H[0][1]=n[0][1]*a.z/h,H[0][2]=(n[0][2]*a.z-n[2][2]*a.x)/h,H[1][0]=n[1][0]*a.z/h,H[1][1]=n[1][1]*a.z/h,H[1][2]=(n[1][2]*a.z-n[2][2]*a.y)/h,j[0][0]=o[0][2]*l,j[0][1]=-o[0][2]*s,j[0][2]=o[0][1]*s-o[0][0]*l,j[0][3]=o[0][0],j[0][4]=o[0][1],j[0][5]=o[0][2],j[1][0]=o[1][2]*l,j[1][1]=-o[1][2]*s,j[1][2]=o[1][1]*s-o[1][0]*l,j[1][3]=o[1][0],j[1][4]=o[1][1],j[1][5]=o[1][2],j[2][0]=o[2][2]*l,j[2][1]=-o[2][2]*s,j[2][2]=o[2][1]*s-o[2][0]*l,j[2][3]=o[2][0],j[2][4]=o[2][1],j[2][5]=o[2][2];const c=[[],[]];for(let e=0;e<2;e++)for(let t=0;t<6;t++){c[e][t]=0;for(let n=0;n<3;n++)c[e][t]+=H[e][n]*j[n][t]}return c};class N{constructor(e){this.projectionTransform=e}estimate({screenCoords:e,worldCoords:t}){const n=(({screenCoords:e,worldCoords:t,projectionTransform:n})=>{const r=p(t.map((e=>[e.x,e.y])),e.map((e=>[e.x,e.y]))),o=new m.Z([[r[0],r[1],r[2]],[r[3],r[4],r[5]],[r[6],r[7],r[8]]]),s=new m.Z(n),l=(0,y.S)(s).mmul(o).to1DArray(),i=Math.sqrt(l[0]*l[0]+l[3]*l[3]+l[6]*l[6]),a=Math.sqrt(l[1]*l[1]+l[4]*l[4]+l[7]*l[7]),h=(i+a)/2,c=[];c[0]=l[0]/i,c[3]=l[3]/i,c[6]=l[6]/i,c[1]=l[1]/a,c[4]=l[4]/a,c[7]=l[7]/a,c[2]=c[3]*c[7]-c[6]*c[4],c[5]=c[6]*c[1]-c[0]*c[7],c[8]=c[0]*c[4]-c[1]*c[3];const u=Math.sqrt(c[2]*c[2]+c[5]*c[5]+c[8]*c[8]);c[2]/=u,c[5]/=u,c[8]/=u;const f=[];return f[0]=l[2]/h,f[1]=l[5]/h,f[2]=l[8]/h,[[c[0],c[1],c[2],f[0]],[c[3],c[4],c[5],f[1]],[c[6],c[7],c[8],f[2]]]})({screenCoords:e,worldCoords:t,projectionTransform:this.projectionTransform});return n}refineEstimate({initialModelViewTransform:e,worldCoords:t,screenCoords:n}){const r=(({initialModelViewTransform:e,projectionTransform:t,worldCoords:n,screenCoords:r})=>{let o=0,s=0;for(let e=0;e<n.length;e++)o+=n[e].x,s+=n[e].y;o/=n.length,s/=n.length;const l=[];for(let e=0;e<n.length;e++)l.push({x:n[e].x-o,y:n[e].y-s,z:n[e].z});const i=[[],[],[]];for(let t=0;t<3;t++)for(let n=0;n<3;n++)i[t][n]=e[t][n];i[0][3]=e[0][0]*o+e[0][1]*s+e[0][3],i[1][3]=e[1][0]*o+e[1][1]*s+e[1][3],i[2][3]=e[2][0]*o+e[2][1]*s+e[2][3];const a=[1,.8,.6,.4,0];let h=i,c=null;for(let e=0;e<a.length;e++){const n=z({initialModelViewTransform:h,projectionTransform:t,worldCoords:l,screenCoords:r,inlierProb:a[e]});if(h=n.modelViewTransform,n.err<5){c=h;break}}return null===c?null:(c[0][3]=c[0][3]-c[0][0]*o-c[0][1]*s,c[1][3]=c[1][3]-c[1][0]*o-c[1][1]*s,c[2][3]=c[2][3]-c[2][0]*o-c[2][1]*s,c)})({initialModelViewTransform:e,worldCoords:t,screenCoords:n,projectionTransform:this.projectionTransform});return r}}let X=null,R=null,Y=!1,D=null,F=null;onmessage=e=>{const{data:t}=e;if("setup"===t.type)X=t.projectionTransform,R=t.matchingDataList,Y=t.debugMode,D=new v(t.inputWidth,t.inputHeight,Y),F=new N(t.projectionTransform);else if("match"===t.type){const e=t.targetIndexes;let n=-1,r=null,o=null;for(let s=0;s<e.length;s++){const l=e[s],{keyframeIndex:i,screenCoords:a,worldCoords:h,debugExtra:c}=D.matchDetection(R[l],t.featurePoints);if(o=c,-1!==i){const e=F.estimate({screenCoords:a,worldCoords:h});e&&(n=l,r=e);break}}postMessage({type:"matchDone",targetIndex:n,modelViewTransform:r,debugExtra:o})}else if("trackUpdate"===t.type){const{modelViewTransform:e,worldCoords:n,screenCoords:r}=t,o=F.refineEstimate({initialModelViewTransform:e,worldCoords:n,screenCoords:r});postMessage({type:"trackUpdateDone",modelViewTransform:o})}}}},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var s=n[e]={exports:{}};return t[e](s,s.exports,r),s.exports}e=[],r.O=(t,n,o,s)=>{if(!n){var l=1/0;for(c=0;c<e.length;c++){for(var[n,o,s]=e[c],i=!0,a=0;a<n.length;a++)(!1&s||l>=s)&&Object.keys(r.O).every((e=>r.O[e](n[a])))?n.splice(a--,1):(i=!1,s<l&&(l=s));if(i){e.splice(c--,1);var h=o();void 0!==h&&(t=h)}}return t}s=s||0;for(var c=e.length;c>0&&e[c-1][2]>s;c--)e[c]=e[c-1];e[c]=[n,o,s]},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var o=r.O(void 0,[551],(()=>r(938)));o=r.O(o);